<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Price Tracker - Flipkart & Amazon</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* [same CSS as before, kept for brevity] */
  </style>
</head>
<body>
  <header>Price Tracker üîî</header>
  <div class="container">
    <p style="margin-top:2rem">üîó Telegram Notification Login</p>
    <button onclick="loginWithTelegram()">Open Telegram Bot</button>
    <p style="margin-top:2rem">Paste product URL:</p>
    <input type="text" id="productUrl" placeholder="https://www.flipkart.com/... or https://www.amazon.in/..." />
    <p>Set your alert price (‚Çπ):</p>
    <input type="number" id="targetPrice" placeholder="2500" min="1"/>
    <input type="email" id="email" placeholder="Enter your email to link alerts" />
    <input type="text" id="telegramId" placeholder="Your Telegram ID after /start in bot" />
    <button onclick="submitAlert()">üéØ Set Price Alert</button>
    <div class="gif-container">
      <!-- Optionally replace these with real images or use Lottie container as needed -->
      <img src="https://via.placeholder.com/100x100/00bcd4/ffffff?text=Shop" alt="AI Shopping"/>
      <img src="https://via.placeholder.com/100x100/ec407a/ffffff?text=Cart" alt="Cart Flow"/>
    </div>
  </div>
  <script>
    // Update with your deployed Render backend
    const BACKEND_URL = "https://price-tracker-site-4.onrender.com";


    function loginWithTelegram() {
      window.open('https://t.me/pricealert_ai_bot', '_blank');
    }

    function validateEmail(email) {
      return /\S+@\S+\.\S+/.test(email);
    }

    function submitAlert() {
      const url = document.getElementById("productUrl").value.trim();
      const price = parseFloat(document.getElementById("targetPrice").value);
      const email = document.getElementById("email").value.trim();
      const telegramId = document.getElementById("telegramId").value.trim();

      if (!url || (!url.startsWith('http://') && !url.startsWith('https://'))) {
        alert("Enter a valid product URL.");
        return;
      }
      if (isNaN(price) || price <= 0) {
        alert("Enter a valid target price.");
        return;
      }
      if (!validateEmail(email)) {
        alert("Enter a valid email.");
        return;
      }
      if (!telegramId) {
        alert("Enter your Telegram ID.");
        return;
      }

      fetch(`${BACKEND_URL}/save-telegram-id`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ telegram_id: telegramId, email: email })
      })
      .then(res => res.json())
      .then(data => {
        if (data.status === "saved") {
          return fetch(`${BACKEND_URL}/track-price`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              product_url: url,
              alert_price: price,
              email: email
            })
          });
        } else {
          throw new Error("Failed to save Telegram ID: " + (data.error || ""));
        }
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert("‚úÖ Price alert set! Tracking started.");
        } else {
          alert("‚ùå Error: " + (data.message || data.error));
        }
      })
      .catch(err => {
        alert("‚ùå Error: " + err.message);
      });
    }
  </script>
</body>
</html>
